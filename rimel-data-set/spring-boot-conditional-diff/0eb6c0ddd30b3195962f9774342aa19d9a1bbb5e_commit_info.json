{'_old_path': PosixPath('spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/ReactiveWebServerFactoryAutoConfiguration.java'), '_new_path': PosixPath('spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/ReactiveWebServerFactoryAutoConfiguration.java'), 'change_type': <ModificationType.MODIFY: 5>, 'diff': '@@ -65,6 +65,14 @@ public class ReactiveWebServerFactoryAutoConfiguration {\n \t\treturn new ReactiveWebServerFactoryCustomizer(serverProperties);\n \t}\n \n+\n+\t@Bean\n+\t@ConditionalOnClass(name = "org.apache.catalina.startup.Tomcat")\n+\tpublic TomcatReactiveWebServerFactoryCustomizer tomcatReactiveWebServerFactoryCustomizer(\n+\t\t\tServerProperties serverProperties) {\n+\t\treturn new TomcatReactiveWebServerFactoryCustomizer(serverProperties);\n+\t}\n+\n \t@Bean\n \t@ConditionalOnMissingBean\n \t@ConditionalOnProperty(value = "server.forward-headers-strategy",\n', 'source_code': '/*\n * Copyright 2012-2019 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.springframework.boot.autoconfigure.web.reactive;\n\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.BeanFactory;\nimport org.springframework.beans.factory.BeanFactoryAware;\nimport org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\nimport org.springframework.beans.factory.support.BeanDefinitionRegistry;\nimport org.springframework.beans.factory.support.RootBeanDefinition;\nimport org.springframework.boot.autoconfigure.AutoConfigureOrder;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\nimport org.springframework.boot.autoconfigure.web.ServerProperties;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.boot.web.server.WebServerFactoryCustomizerBeanPostProcessor;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.context.annotation.ImportBeanDefinitionRegistrar;\nimport org.springframework.core.Ordered;\nimport org.springframework.core.type.AnnotationMetadata;\nimport org.springframework.http.ReactiveHttpInputMessage;\nimport org.springframework.util.ObjectUtils;\nimport org.springframework.web.server.adapter.ForwardedHeaderTransformer;\n\n/**\n * {@link EnableAutoConfiguration Auto-configuration} for a reactive web server.\n *\n * @author Brian Clozel\n * @since 2.0.0\n */\n@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)\n@Configuration(proxyBeanMethods = false)\n@ConditionalOnClass(ReactiveHttpInputMessage.class)\n@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.REACTIVE)\n@EnableConfigurationProperties(ServerProperties.class)\n@Import({ ReactiveWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedTomcat.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedJetty.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedUndertow.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedNetty.class })\npublic class ReactiveWebServerFactoryAutoConfiguration {\n\n\t@Bean\n\tpublic ReactiveWebServerFactoryCustomizer reactiveWebServerFactoryCustomizer(\n\t\t\tServerProperties serverProperties) {\n\t\treturn new ReactiveWebServerFactoryCustomizer(serverProperties);\n\t}\n\n\n\t@Bean\n\t@ConditionalOnClass(name = "org.apache.catalina.startup.Tomcat")\n\tpublic TomcatReactiveWebServerFactoryCustomizer tomcatReactiveWebServerFactoryCustomizer(\n\t\t\tServerProperties serverProperties) {\n\t\treturn new TomcatReactiveWebServerFactoryCustomizer(serverProperties);\n\t}\n\n\t@Bean\n\t@ConditionalOnMissingBean\n\t@ConditionalOnProperty(value = "server.forward-headers-strategy",\n\t\t\thavingValue = "framework")\n\tpublic ForwardedHeaderTransformer forwardedHeaderTransformer() {\n\t\treturn new ForwardedHeaderTransformer();\n\t}\n\n\t/**\n\t * Registers a {@link WebServerFactoryCustomizerBeanPostProcessor}. Registered via\n\t * {@link ImportBeanDefinitionRegistrar} for early registration.\n\t */\n\tpublic static class BeanPostProcessorsRegistrar\n\t\t\timplements ImportBeanDefinitionRegistrar, BeanFactoryAware {\n\n\t\tprivate ConfigurableListableBeanFactory beanFactory;\n\n\t\t@Override\n\t\tpublic void setBeanFactory(BeanFactory beanFactory) throws BeansException {\n\t\t\tif (beanFactory instanceof ConfigurableListableBeanFactory) {\n\t\t\t\tthis.beanFactory = (ConfigurableListableBeanFactory) beanFactory;\n\t\t\t}\n\t\t}\n\n\t\t@Override\n\t\tpublic void registerBeanDefinitions(AnnotationMetadata importingClassMetadata,\n\t\t\t\tBeanDefinitionRegistry registry) {\n\t\t\tif (this.beanFactory == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tregisterSyntheticBeanIfMissing(registry,\n\t\t\t\t\t"webServerFactoryCustomizerBeanPostProcessor",\n\t\t\t\t\tWebServerFactoryCustomizerBeanPostProcessor.class);\n\t\t}\n\n\t\tprivate void registerSyntheticBeanIfMissing(BeanDefinitionRegistry registry,\n\t\t\t\tString name, Class<?> beanClass) {\n\t\t\tif (ObjectUtils.isEmpty(\n\t\t\t\t\tthis.beanFactory.getBeanNamesForType(beanClass, true, false))) {\n\t\t\t\tRootBeanDefinition beanDefinition = new RootBeanDefinition(beanClass);\n\t\t\t\tbeanDefinition.setSynthetic(true);\n\t\t\t\tregistry.registerBeanDefinition(name, beanDefinition);\n\t\t\t}\n\t\t}\n\n\t}\n\n}\n', 'source_code_before': '/*\n * Copyright 2012-2019 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.springframework.boot.autoconfigure.web.reactive;\n\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.BeanFactory;\nimport org.springframework.beans.factory.BeanFactoryAware;\nimport org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\nimport org.springframework.beans.factory.support.BeanDefinitionRegistry;\nimport org.springframework.beans.factory.support.RootBeanDefinition;\nimport org.springframework.boot.autoconfigure.AutoConfigureOrder;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\nimport org.springframework.boot.autoconfigure.web.ServerProperties;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.boot.web.server.WebServerFactoryCustomizerBeanPostProcessor;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.context.annotation.ImportBeanDefinitionRegistrar;\nimport org.springframework.core.Ordered;\nimport org.springframework.core.type.AnnotationMetadata;\nimport org.springframework.http.ReactiveHttpInputMessage;\nimport org.springframework.util.ObjectUtils;\nimport org.springframework.web.server.adapter.ForwardedHeaderTransformer;\n\n/**\n * {@link EnableAutoConfiguration Auto-configuration} for a reactive web server.\n *\n * @author Brian Clozel\n * @since 2.0.0\n */\n@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)\n@Configuration(proxyBeanMethods = false)\n@ConditionalOnClass(ReactiveHttpInputMessage.class)\n@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.REACTIVE)\n@EnableConfigurationProperties(ServerProperties.class)\n@Import({ ReactiveWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedTomcat.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedJetty.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedUndertow.class,\n\t\tReactiveWebServerFactoryConfiguration.EmbeddedNetty.class })\npublic class ReactiveWebServerFactoryAutoConfiguration {\n\n\t@Bean\n\tpublic ReactiveWebServerFactoryCustomizer reactiveWebServerFactoryCustomizer(\n\t\t\tServerProperties serverProperties) {\n\t\treturn new ReactiveWebServerFactoryCustomizer(serverProperties);\n\t}\n\n\t@Bean\n\t@ConditionalOnMissingBean\n\t@ConditionalOnProperty(value = "server.forward-headers-strategy",\n\t\t\thavingValue = "framework")\n\tpublic ForwardedHeaderTransformer forwardedHeaderTransformer() {\n\t\treturn new ForwardedHeaderTransformer();\n\t}\n\n\t/**\n\t * Registers a {@link WebServerFactoryCustomizerBeanPostProcessor}. Registered via\n\t * {@link ImportBeanDefinitionRegistrar} for early registration.\n\t */\n\tpublic static class BeanPostProcessorsRegistrar\n\t\t\timplements ImportBeanDefinitionRegistrar, BeanFactoryAware {\n\n\t\tprivate ConfigurableListableBeanFactory beanFactory;\n\n\t\t@Override\n\t\tpublic void setBeanFactory(BeanFactory beanFactory) throws BeansException {\n\t\t\tif (beanFactory instanceof ConfigurableListableBeanFactory) {\n\t\t\t\tthis.beanFactory = (ConfigurableListableBeanFactory) beanFactory;\n\t\t\t}\n\t\t}\n\n\t\t@Override\n\t\tpublic void registerBeanDefinitions(AnnotationMetadata importingClassMetadata,\n\t\t\t\tBeanDefinitionRegistry registry) {\n\t\t\tif (this.beanFactory == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tregisterSyntheticBeanIfMissing(registry,\n\t\t\t\t\t"webServerFactoryCustomizerBeanPostProcessor",\n\t\t\t\t\tWebServerFactoryCustomizerBeanPostProcessor.class);\n\t\t}\n\n\t\tprivate void registerSyntheticBeanIfMissing(BeanDefinitionRegistry registry,\n\t\t\t\tString name, Class<?> beanClass) {\n\t\t\tif (ObjectUtils.isEmpty(\n\t\t\t\t\tthis.beanFactory.getBeanNamesForType(beanClass, true, false))) {\n\t\t\t\tRootBeanDefinition beanDefinition = new RootBeanDefinition(beanClass);\n\t\t\t\tbeanDefinition.setSynthetic(true);\n\t\t\t\tregistry.registerBeanDefinition(name, beanDefinition);\n\t\t\t}\n\t\t}\n\n\t}\n\n}\n', '_nloc': None, '_complexity': None, '_token_count': None, '_function_list': []}
