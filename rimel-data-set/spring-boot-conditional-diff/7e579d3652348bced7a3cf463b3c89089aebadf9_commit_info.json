{'_old_path': PosixPath('spring-bootstrap/src/main/java/org/springframework/bootstrap/autoconfigure/jdbc/DataSourceAutoConfiguration.java'), '_new_path': PosixPath('spring-bootstrap/src/main/java/org/springframework/bootstrap/autoconfigure/jdbc/DataSourceAutoConfiguration.java'), 'change_type': <ModificationType.MODIFY: 5>, 'diff': '@@ -58,7 +58,7 @@ import org.springframework.util.StringUtils;\n  */\n @Configuration\n @ConditionalOnClass(EmbeddedDatabaseType.class /* Spring JDBC */)\n-// @ConditionalOnMissingBean(DataSource.class)\n+@ConditionalOnMissingBean(DataSource.class)\n public class DataSourceAutoConfiguration {\n \n \t// FIXME see above\n@@ -109,7 +109,7 @@ public class DataSourceAutoConfiguration {\n \t}\n \n \t// FIXME: DB platform\n-\t@Value("${spring.database.schema:classpath*:schema.sql}")\n+\t@Value("${spring.database.schema:classpath*:schema-${spring.database.platform:all}.sql}")\n \tprivate String schemaLocations = "";\n \n \t@PostConstruct\n', 'source_code': '/*\n * Copyright 2012-2013 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.springframework.bootstrap.autoconfigure.jdbc;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\n\nimport javax.annotation.PostConstruct;\nimport javax.sql.DataSource;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.springframework.beans.factory.BeanFactoryUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.bootstrap.context.annotation.ConditionLogUtils;\nimport org.springframework.bootstrap.context.annotation.ConditionalOnClass;\nimport org.springframework.bootstrap.context.annotation.ConditionalOnMissingBean;\nimport org.springframework.bootstrap.context.annotation.EnableAutoConfiguration;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Condition;\nimport org.springframework.context.annotation.ConditionContext;\nimport org.springframework.context.annotation.Conditional;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.core.io.Resource;\nimport org.springframework.core.type.AnnotatedTypeMetadata;\nimport org.springframework.jdbc.core.JdbcOperations;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.jdbc.core.namedparam.NamedParameterJdbcOperations;\nimport org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;\nimport org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;\nimport org.springframework.jdbc.datasource.init.DatabasePopulatorUtils;\nimport org.springframework.jdbc.datasource.init.ResourceDatabasePopulator;\nimport org.springframework.util.ClassUtils;\nimport org.springframework.util.StringUtils;\n\n/**\n * {@link EnableAutoConfiguration Auto-configuration} for {@link DataSource}.\n * \n * @author Dave Syer\n */\n@Configuration\n@ConditionalOnClass(EmbeddedDatabaseType.class /* Spring JDBC */)\n@ConditionalOnMissingBean(DataSource.class)\npublic class DataSourceAutoConfiguration {\n\n\t// FIXME see above\n\n\tprivate static Log logger = LogFactory.getLog(DataSourceAutoConfiguration.class);\n\n\t@Autowired(required = false)\n\tprivate DataSource dataSource;\n\n\t@Autowired\n\tprivate ApplicationContext applicationContext;\n\n\t@Conditional(DataSourceAutoConfiguration.EmbeddedDatabaseCondition.class)\n\t@Import(EmbeddedDatabaseConfiguration.class)\n\tprotected static class EmbeddedConfiguration {\n\t}\n\n\t@Conditional(DataSourceAutoConfiguration.TomcatDatabaseCondition.class)\n\t@Import(TomcatDataSourceConfiguration.class)\n\tprotected static class TomcatConfiguration {\n\t}\n\n\t@Conditional(DataSourceAutoConfiguration.BasicDatabaseCondition.class)\n\t@Import(BasicDataSourceConfiguration.class)\n\tprotected static class DbcpConfiguration {\n\t}\n\n\t@Configuration\n\t@Conditional(DataSourceAutoConfiguration.SomeDatabaseCondition.class)\n\t// FIXME: make this @ConditionalOnBean(DataSource.class)\n\tprotected static class JdbcTemplateConfiguration {\n\n\t\t@Autowired(required = false)\n\t\tprivate DataSource dataSource;\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(JdbcOperations.class)\n\t\tpublic JdbcOperations jdbcTemplate() {\n\t\t\treturn new JdbcTemplate(this.dataSource);\n\t\t}\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(NamedParameterJdbcOperations.class)\n\t\tpublic NamedParameterJdbcOperations namedParameterJdbcTemplate() {\n\t\t\treturn new NamedParameterJdbcTemplate(this.dataSource);\n\t\t}\n\n\t}\n\n\t// FIXME: DB platform\n\t@Value("${spring.database.schema:classpath*:schema-${spring.database.platform:all}.sql}")\n\tprivate String schemaLocations = "";\n\n\t@PostConstruct\n\tprotected void initialize() throws Exception {\n\t\tif (this.dataSource == null) {\n\t\t\tlogger.debug("No DataSource found so not initializing");\n\t\t\treturn;\n\t\t}\n\t\tResourceDatabasePopulator populator = new ResourceDatabasePopulator();\n\t\tboolean exists = false;\n\t\tList<Resource> resources = new ArrayList<Resource>();\n\t\tfor (String location : StringUtils\n\t\t\t\t.commaDelimitedListToStringArray(this.schemaLocations)) {\n\t\t\tresources\n\t\t\t\t\t.addAll(Arrays.asList(this.applicationContext.getResources(location)));\n\t\t}\n\t\tfor (Resource resource : resources) {\n\t\t\tif (resource.exists()) {\n\t\t\t\texists = true;\n\t\t\t\tpopulator.addScript(resource);\n\t\t\t\tpopulator.setContinueOnError(true);\n\t\t\t}\n\t\t}\n\t\tif (exists) {\n\t\t\tDatabasePopulatorUtils.execute(populator, this.dataSource);\n\t\t}\n\t}\n\n\tstatic class SomeDatabaseCondition implements Condition {\n\n\t\tprotected Log logger = LogFactory.getLog(getClass());\n\n\t\tprivate Condition tomcatCondition = new TomcatDatabaseCondition();\n\n\t\tprivate Condition dbcpCondition = new BasicDatabaseCondition();\n\n\t\tprivate Condition embeddedCondition = new EmbeddedDatabaseCondition();\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\n\t\t\tString checking = ConditionLogUtils.getPrefix(this.logger, metadata);\n\n\t\t\tif (this.tomcatCondition.matches(context, metadata)\n\t\t\t\t\t|| this.dbcpCondition.matches(context, metadata)\n\t\t\t\t\t|| this.embeddedCondition.matches(context, metadata)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger.debug(checking\n\t\t\t\t\t\t\t+ "Existing auto database detected: match result true");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (BeanFactoryUtils.beanNamesForTypeIncludingAncestors(\n\t\t\t\t\tcontext.getBeanFactory(), DataSource.class, true, false).length > 0) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger\n\t\t\t\t\t\t\t.debug(checking\n\t\t\t\t\t\t\t\t\t+ "Existing bean configured database detected: match result true");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger\n\t\t\t\t\t\t.debug(checking\n\t\t\t\t\t\t\t\t+ "Existing bean configured database not detected: match result false");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t}\n\n\tstatic class TomcatDatabaseCondition extends NonEmbeddedDatabaseCondition {\n\n\t\t@Override\n\t\tprotected String getDataSourecClassName() {\n\t\t\treturn "org.apache.tomcat.jdbc.pool.DataSource";\n\t\t}\n\n\t}\n\n\tstatic class BasicDatabaseCondition extends NonEmbeddedDatabaseCondition {\n\n\t\tprivate Condition condition = new TomcatDatabaseCondition();\n\n\t\t@Override\n\t\tprotected String getDataSourecClassName() {\n\t\t\treturn "org.apache.commons.dbcp.BasicDataSource";\n\t\t}\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\t\t\tif (this.condition.matches(context, metadata)) {\n\t\t\t\treturn false; // prefer Tomcat pool\n\t\t\t}\n\t\t\treturn super.matches(context, metadata);\n\t\t}\n\t}\n\n\tstatic abstract class NonEmbeddedDatabaseCondition implements Condition {\n\n\t\tprotected Log logger = LogFactory.getLog(getClass());\n\n\t\tprotected abstract String getDataSourecClassName();\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\n\t\t\tString checking = ConditionLogUtils.getPrefix(this.logger, metadata);\n\n\t\t\tif (!ClassUtils.isPresent(getDataSourecClassName(), null)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger.debug(checking + "Tomcat DataSource pool not found");\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tString driverClassName = context.getEnvironment().getProperty(\n\t\t\t\t\t"spring.database.driverClassName");\n\t\t\tString url = context.getEnvironment().getProperty("spring.database.url");\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger.debug(checking\n\t\t\t\t\t\t+ "Spring JDBC detected (embedded database type is "\n\t\t\t\t\t\t+ EmbeddedDatabaseConfiguration.getEmbeddedDatabaseType() + ").");\n\t\t\t}\n\t\t\tif (driverClassName == null) {\n\t\t\t\tdriverClassName = EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t.getEmbeddedDatabaseDriverClass(EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t\t\t.getEmbeddedDatabaseType());\n\t\t\t}\n\t\t\tif (url == null) {\n\t\t\t\turl = EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t.getEmbeddedDatabaseUrl(EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t\t\t.getEmbeddedDatabaseType());\n\t\t\t}\n\t\t\tif (driverClassName != null && url != null\n\t\t\t\t\t&& ClassUtils.isPresent(driverClassName, null)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger.debug(checking + "Driver class " + driverClassName\n\t\t\t\t\t\t\t+ " found");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger.debug(checking + "Driver class " + driverClassName\n\t\t\t\t\t\t+ " not found");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t}\n\n\tstatic class EmbeddedDatabaseCondition implements Condition {\n\n\t\tprotected Log logger = LogFactory.getLog(getClass());\n\n\t\tprivate Condition tomcatCondition = new TomcatDatabaseCondition();\n\n\t\tprivate Condition dbcpCondition = new BasicDatabaseCondition();\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\n\t\t\tString checking = ConditionLogUtils.getPrefix(this.logger, metadata);\n\n\t\t\tif (this.tomcatCondition.matches(context, metadata)\n\t\t\t\t\t|| this.dbcpCondition.matches(context, metadata)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger\n\t\t\t\t\t\t\t.debug(checking\n\t\t\t\t\t\t\t\t\t+ "Existing non-embedded database detected: match result false");\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger.debug(checking\n\t\t\t\t\t\t+ "Spring JDBC detected (embedded database type is "\n\t\t\t\t\t\t+ EmbeddedDatabaseConfiguration.getEmbeddedDatabaseType() + ").");\n\t\t\t}\n\t\t\treturn EmbeddedDatabaseConfiguration.getEmbeddedDatabaseType() != null;\n\t\t}\n\t}\n\n}\n', 'source_code_before': '/*\n * Copyright 2012-2013 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.springframework.bootstrap.autoconfigure.jdbc;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\n\nimport javax.annotation.PostConstruct;\nimport javax.sql.DataSource;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.springframework.beans.factory.BeanFactoryUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.bootstrap.context.annotation.ConditionLogUtils;\nimport org.springframework.bootstrap.context.annotation.ConditionalOnClass;\nimport org.springframework.bootstrap.context.annotation.ConditionalOnMissingBean;\nimport org.springframework.bootstrap.context.annotation.EnableAutoConfiguration;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Condition;\nimport org.springframework.context.annotation.ConditionContext;\nimport org.springframework.context.annotation.Conditional;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.core.io.Resource;\nimport org.springframework.core.type.AnnotatedTypeMetadata;\nimport org.springframework.jdbc.core.JdbcOperations;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.jdbc.core.namedparam.NamedParameterJdbcOperations;\nimport org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;\nimport org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;\nimport org.springframework.jdbc.datasource.init.DatabasePopulatorUtils;\nimport org.springframework.jdbc.datasource.init.ResourceDatabasePopulator;\nimport org.springframework.util.ClassUtils;\nimport org.springframework.util.StringUtils;\n\n/**\n * {@link EnableAutoConfiguration Auto-configuration} for {@link DataSource}.\n * \n * @author Dave Syer\n */\n@Configuration\n@ConditionalOnClass(EmbeddedDatabaseType.class /* Spring JDBC */)\n// @ConditionalOnMissingBean(DataSource.class)\npublic class DataSourceAutoConfiguration {\n\n\t// FIXME see above\n\n\tprivate static Log logger = LogFactory.getLog(DataSourceAutoConfiguration.class);\n\n\t@Autowired(required = false)\n\tprivate DataSource dataSource;\n\n\t@Autowired\n\tprivate ApplicationContext applicationContext;\n\n\t@Conditional(DataSourceAutoConfiguration.EmbeddedDatabaseCondition.class)\n\t@Import(EmbeddedDatabaseConfiguration.class)\n\tprotected static class EmbeddedConfiguration {\n\t}\n\n\t@Conditional(DataSourceAutoConfiguration.TomcatDatabaseCondition.class)\n\t@Import(TomcatDataSourceConfiguration.class)\n\tprotected static class TomcatConfiguration {\n\t}\n\n\t@Conditional(DataSourceAutoConfiguration.BasicDatabaseCondition.class)\n\t@Import(BasicDataSourceConfiguration.class)\n\tprotected static class DbcpConfiguration {\n\t}\n\n\t@Configuration\n\t@Conditional(DataSourceAutoConfiguration.SomeDatabaseCondition.class)\n\t// FIXME: make this @ConditionalOnBean(DataSource.class)\n\tprotected static class JdbcTemplateConfiguration {\n\n\t\t@Autowired(required = false)\n\t\tprivate DataSource dataSource;\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(JdbcOperations.class)\n\t\tpublic JdbcOperations jdbcTemplate() {\n\t\t\treturn new JdbcTemplate(this.dataSource);\n\t\t}\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(NamedParameterJdbcOperations.class)\n\t\tpublic NamedParameterJdbcOperations namedParameterJdbcTemplate() {\n\t\t\treturn new NamedParameterJdbcTemplate(this.dataSource);\n\t\t}\n\n\t}\n\n\t// FIXME: DB platform\n\t@Value("${spring.database.schema:classpath*:schema.sql}")\n\tprivate String schemaLocations = "";\n\n\t@PostConstruct\n\tprotected void initialize() throws Exception {\n\t\tif (this.dataSource == null) {\n\t\t\tlogger.debug("No DataSource found so not initializing");\n\t\t\treturn;\n\t\t}\n\t\tResourceDatabasePopulator populator = new ResourceDatabasePopulator();\n\t\tboolean exists = false;\n\t\tList<Resource> resources = new ArrayList<Resource>();\n\t\tfor (String location : StringUtils\n\t\t\t\t.commaDelimitedListToStringArray(this.schemaLocations)) {\n\t\t\tresources\n\t\t\t\t\t.addAll(Arrays.asList(this.applicationContext.getResources(location)));\n\t\t}\n\t\tfor (Resource resource : resources) {\n\t\t\tif (resource.exists()) {\n\t\t\t\texists = true;\n\t\t\t\tpopulator.addScript(resource);\n\t\t\t\tpopulator.setContinueOnError(true);\n\t\t\t}\n\t\t}\n\t\tif (exists) {\n\t\t\tDatabasePopulatorUtils.execute(populator, this.dataSource);\n\t\t}\n\t}\n\n\tstatic class SomeDatabaseCondition implements Condition {\n\n\t\tprotected Log logger = LogFactory.getLog(getClass());\n\n\t\tprivate Condition tomcatCondition = new TomcatDatabaseCondition();\n\n\t\tprivate Condition dbcpCondition = new BasicDatabaseCondition();\n\n\t\tprivate Condition embeddedCondition = new EmbeddedDatabaseCondition();\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\n\t\t\tString checking = ConditionLogUtils.getPrefix(this.logger, metadata);\n\n\t\t\tif (this.tomcatCondition.matches(context, metadata)\n\t\t\t\t\t|| this.dbcpCondition.matches(context, metadata)\n\t\t\t\t\t|| this.embeddedCondition.matches(context, metadata)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger.debug(checking\n\t\t\t\t\t\t\t+ "Existing auto database detected: match result true");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (BeanFactoryUtils.beanNamesForTypeIncludingAncestors(\n\t\t\t\t\tcontext.getBeanFactory(), DataSource.class, true, false).length > 0) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger\n\t\t\t\t\t\t\t.debug(checking\n\t\t\t\t\t\t\t\t\t+ "Existing bean configured database detected: match result true");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger\n\t\t\t\t\t\t.debug(checking\n\t\t\t\t\t\t\t\t+ "Existing bean configured database not detected: match result false");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t}\n\n\tstatic class TomcatDatabaseCondition extends NonEmbeddedDatabaseCondition {\n\n\t\t@Override\n\t\tprotected String getDataSourecClassName() {\n\t\t\treturn "org.apache.tomcat.jdbc.pool.DataSource";\n\t\t}\n\n\t}\n\n\tstatic class BasicDatabaseCondition extends NonEmbeddedDatabaseCondition {\n\n\t\tprivate Condition condition = new TomcatDatabaseCondition();\n\n\t\t@Override\n\t\tprotected String getDataSourecClassName() {\n\t\t\treturn "org.apache.commons.dbcp.BasicDataSource";\n\t\t}\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\t\t\tif (this.condition.matches(context, metadata)) {\n\t\t\t\treturn false; // prefer Tomcat pool\n\t\t\t}\n\t\t\treturn super.matches(context, metadata);\n\t\t}\n\t}\n\n\tstatic abstract class NonEmbeddedDatabaseCondition implements Condition {\n\n\t\tprotected Log logger = LogFactory.getLog(getClass());\n\n\t\tprotected abstract String getDataSourecClassName();\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\n\t\t\tString checking = ConditionLogUtils.getPrefix(this.logger, metadata);\n\n\t\t\tif (!ClassUtils.isPresent(getDataSourecClassName(), null)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger.debug(checking + "Tomcat DataSource pool not found");\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tString driverClassName = context.getEnvironment().getProperty(\n\t\t\t\t\t"spring.database.driverClassName");\n\t\t\tString url = context.getEnvironment().getProperty("spring.database.url");\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger.debug(checking\n\t\t\t\t\t\t+ "Spring JDBC detected (embedded database type is "\n\t\t\t\t\t\t+ EmbeddedDatabaseConfiguration.getEmbeddedDatabaseType() + ").");\n\t\t\t}\n\t\t\tif (driverClassName == null) {\n\t\t\t\tdriverClassName = EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t.getEmbeddedDatabaseDriverClass(EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t\t\t.getEmbeddedDatabaseType());\n\t\t\t}\n\t\t\tif (url == null) {\n\t\t\t\turl = EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t.getEmbeddedDatabaseUrl(EmbeddedDatabaseConfiguration\n\t\t\t\t\t\t\t\t.getEmbeddedDatabaseType());\n\t\t\t}\n\t\t\tif (driverClassName != null && url != null\n\t\t\t\t\t&& ClassUtils.isPresent(driverClassName, null)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger.debug(checking + "Driver class " + driverClassName\n\t\t\t\t\t\t\t+ " found");\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger.debug(checking + "Driver class " + driverClassName\n\t\t\t\t\t\t+ " not found");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t}\n\n\tstatic class EmbeddedDatabaseCondition implements Condition {\n\n\t\tprotected Log logger = LogFactory.getLog(getClass());\n\n\t\tprivate Condition tomcatCondition = new TomcatDatabaseCondition();\n\n\t\tprivate Condition dbcpCondition = new BasicDatabaseCondition();\n\n\t\t@Override\n\t\tpublic boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n\n\t\t\tString checking = ConditionLogUtils.getPrefix(this.logger, metadata);\n\n\t\t\tif (this.tomcatCondition.matches(context, metadata)\n\t\t\t\t\t|| this.dbcpCondition.matches(context, metadata)) {\n\t\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\t\tthis.logger\n\t\t\t\t\t\t\t.debug(checking\n\t\t\t\t\t\t\t\t\t+ "Existing non-embedded database detected: match result false");\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.logger.isDebugEnabled()) {\n\t\t\t\tthis.logger.debug(checking\n\t\t\t\t\t\t+ "Spring JDBC detected (embedded database type is "\n\t\t\t\t\t\t+ EmbeddedDatabaseConfiguration.getEmbeddedDatabaseType() + ").");\n\t\t\t}\n\t\t\treturn EmbeddedDatabaseConfiguration.getEmbeddedDatabaseType() != null;\n\t\t}\n\t}\n\n}\n', '_nloc': None, '_complexity': None, '_token_count': None, '_function_list': []}
