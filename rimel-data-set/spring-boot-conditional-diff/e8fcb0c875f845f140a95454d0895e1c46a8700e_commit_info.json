{'_old_path': PosixPath('spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/social/SocialWebAutoConfiguration.java'), '_new_path': PosixPath('spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/social/SocialWebAutoConfiguration.java'), 'change_type': <ModificationType.MODIFY: 5>, 'diff': '@@ -119,7 +119,7 @@ public class SocialWebAutoConfiguration {\n \t@Configuration\n \t@EnableSocial\n \t@ConditionalOnWebApplication\n-\t@ConditionalOnMissingClass(SecurityContextHolder.class)\n+\t@ConditionalOnMissingClass(name="org.springframework.security.core.context.SecurityContextHolder")\n \tprotected static class AnonymousUserIdSourceConfig extends SocialConfigurerAdapter {\n \n \t\t@Override\n', 'source_code': '/*\n * Copyright 2012-2014 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.springframework.boot.autoconfigure.social;\n\nimport java.util.List;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.AutoConfigureAfter;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\nimport org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContext;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.social.UserIdSource;\nimport org.springframework.social.config.annotation.EnableSocial;\nimport org.springframework.social.config.annotation.SocialConfigurerAdapter;\nimport org.springframework.social.connect.ConnectionFactoryLocator;\nimport org.springframework.social.connect.ConnectionRepository;\nimport org.springframework.social.connect.UsersConnectionRepository;\nimport org.springframework.social.connect.web.ConnectController;\nimport org.springframework.social.connect.web.ConnectInterceptor;\nimport org.springframework.social.connect.web.DisconnectInterceptor;\nimport org.springframework.social.connect.web.ProviderSignInController;\nimport org.springframework.social.connect.web.ProviderSignInInterceptor;\nimport org.springframework.social.connect.web.SignInAdapter;\nimport org.springframework.util.Assert;\nimport org.springframework.util.CollectionUtils;\nimport org.springframework.web.servlet.ViewResolver;\nimport org.springframework.web.servlet.view.BeanNameViewResolver;\n\n/**\n * {@link EnableAutoConfiguration Auto-configuration} for Spring Social\'s web connection\n * support.\n * \n * @author Craig Walls\n * @since 1.1.0\n */\n@Configuration\n@ConditionalOnClass({ ConnectController.class, SocialConfigurerAdapter.class })\n@AutoConfigureAfter(WebMvcAutoConfiguration.class)\npublic class SocialWebAutoConfiguration {\n\n\t@Configuration\n\t@EnableSocial\n\t@ConditionalOnWebApplication\n\tprotected static class SocialAutoConfigurationAdapter extends SocialConfigurerAdapter {\n\n\t\t@Autowired(required = false)\n\t\tprivate List<ConnectInterceptor<?>> connectInterceptors;\n\n\t\t@Autowired(required = false)\n\t\tprivate List<DisconnectInterceptor<?>> disconnectInterceptors;\n\n\t\t@Autowired(required = false)\n\t\tprivate List<ProviderSignInInterceptor<?>> signInInterceptors;\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(ConnectController.class)\n\t\tpublic ConnectController connectController(\n\t\t\t\tConnectionFactoryLocator factoryLocator, ConnectionRepository repository) {\n\t\t\tConnectController controller = new ConnectController(factoryLocator,\n\t\t\t\t\trepository);\n\t\t\tif (!CollectionUtils.isEmpty(this.connectInterceptors)) {\n\t\t\t\tcontroller.setConnectInterceptors(this.connectInterceptors);\n\t\t\t}\n\t\t\tif (!CollectionUtils.isEmpty(this.disconnectInterceptors)) {\n\t\t\t\tcontroller.setDisconnectInterceptors(this.disconnectInterceptors);\n\t\t\t}\n\t\t\treturn controller;\n\t\t}\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(BeanNameViewResolver.class)\n\t\t@ConditionalOnProperty(prefix = "spring.social.", value = "auto-connection-views")\n\t\tpublic ViewResolver beanNameViewResolver() {\n\t\t\tBeanNameViewResolver viewResolver = new BeanNameViewResolver();\n\t\t\tviewResolver.setOrder(Integer.MIN_VALUE);\n\t\t\treturn viewResolver;\n\t\t}\n\n\t\t@Bean\n\t\t@ConditionalOnBean(SignInAdapter.class)\n\t\t@ConditionalOnMissingBean(ProviderSignInController.class)\n\t\tpublic ProviderSignInController signInController(\n\t\t\t\tConnectionFactoryLocator factoryLocator,\n\t\t\t\tUsersConnectionRepository usersRepository, SignInAdapter signInAdapter) {\n\t\t\tProviderSignInController controller = new ProviderSignInController(\n\t\t\t\t\tfactoryLocator, usersRepository, signInAdapter);\n\t\t\tif (!CollectionUtils.isEmpty(this.signInInterceptors)) {\n\t\t\t\tcontroller.setSignInInterceptors(this.signInInterceptors);\n\t\t\t}\n\t\t\treturn controller;\n\t\t}\n\n\t}\n\n\t@Configuration\n\t@EnableSocial\n\t@ConditionalOnWebApplication\n\t@ConditionalOnMissingClass(name="org.springframework.security.core.context.SecurityContextHolder")\n\tprotected static class AnonymousUserIdSourceConfig extends SocialConfigurerAdapter {\n\n\t\t@Override\n\t\tpublic UserIdSource getUserIdSource() {\n\t\t\treturn new UserIdSource() {\n\t\t\t\t@Override\n\t\t\t\tpublic String getUserId() {\n\t\t\t\t\treturn "anonymous";\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t}\n\n\t@Configuration\n\t@EnableSocial\n\t@ConditionalOnWebApplication\n\t@ConditionalOnClass(SecurityContextHolder.class)\n\tprotected static class AuthenticationUserIdSourceConfig extends\n\t\t\tSocialConfigurerAdapter {\n\n\t\t@Override\n\t\tpublic UserIdSource getUserIdSource() {\n\t\t\treturn new SecurityContextUserIdSource();\n\t\t}\n\n\t}\n\n\tprivate static class SecurityContextUserIdSource implements UserIdSource {\n\n\t\t@Override\n\t\tpublic String getUserId() {\n\t\t\tSecurityContext context = SecurityContextHolder.getContext();\n\t\t\tAuthentication authentication = context.getAuthentication();\n\t\t\tAssert.state(authentication != null, "Unable to get a "\n\t\t\t\t\t+ "ConnectionRepository: no user signed in");\n\t\t\treturn authentication.getName();\n\t\t}\n\n\t}\n}\n', 'source_code_before': '/*\n * Copyright 2012-2014 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.springframework.boot.autoconfigure.social;\n\nimport java.util.List;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.AutoConfigureAfter;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\nimport org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContext;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.social.UserIdSource;\nimport org.springframework.social.config.annotation.EnableSocial;\nimport org.springframework.social.config.annotation.SocialConfigurerAdapter;\nimport org.springframework.social.connect.ConnectionFactoryLocator;\nimport org.springframework.social.connect.ConnectionRepository;\nimport org.springframework.social.connect.UsersConnectionRepository;\nimport org.springframework.social.connect.web.ConnectController;\nimport org.springframework.social.connect.web.ConnectInterceptor;\nimport org.springframework.social.connect.web.DisconnectInterceptor;\nimport org.springframework.social.connect.web.ProviderSignInController;\nimport org.springframework.social.connect.web.ProviderSignInInterceptor;\nimport org.springframework.social.connect.web.SignInAdapter;\nimport org.springframework.util.Assert;\nimport org.springframework.util.CollectionUtils;\nimport org.springframework.web.servlet.ViewResolver;\nimport org.springframework.web.servlet.view.BeanNameViewResolver;\n\n/**\n * {@link EnableAutoConfiguration Auto-configuration} for Spring Social\'s web connection\n * support.\n * \n * @author Craig Walls\n * @since 1.1.0\n */\n@Configuration\n@ConditionalOnClass({ ConnectController.class, SocialConfigurerAdapter.class })\n@AutoConfigureAfter(WebMvcAutoConfiguration.class)\npublic class SocialWebAutoConfiguration {\n\n\t@Configuration\n\t@EnableSocial\n\t@ConditionalOnWebApplication\n\tprotected static class SocialAutoConfigurationAdapter extends SocialConfigurerAdapter {\n\n\t\t@Autowired(required = false)\n\t\tprivate List<ConnectInterceptor<?>> connectInterceptors;\n\n\t\t@Autowired(required = false)\n\t\tprivate List<DisconnectInterceptor<?>> disconnectInterceptors;\n\n\t\t@Autowired(required = false)\n\t\tprivate List<ProviderSignInInterceptor<?>> signInInterceptors;\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(ConnectController.class)\n\t\tpublic ConnectController connectController(\n\t\t\t\tConnectionFactoryLocator factoryLocator, ConnectionRepository repository) {\n\t\t\tConnectController controller = new ConnectController(factoryLocator,\n\t\t\t\t\trepository);\n\t\t\tif (!CollectionUtils.isEmpty(this.connectInterceptors)) {\n\t\t\t\tcontroller.setConnectInterceptors(this.connectInterceptors);\n\t\t\t}\n\t\t\tif (!CollectionUtils.isEmpty(this.disconnectInterceptors)) {\n\t\t\t\tcontroller.setDisconnectInterceptors(this.disconnectInterceptors);\n\t\t\t}\n\t\t\treturn controller;\n\t\t}\n\n\t\t@Bean\n\t\t@ConditionalOnMissingBean(BeanNameViewResolver.class)\n\t\t@ConditionalOnProperty(prefix = "spring.social.", value = "auto-connection-views")\n\t\tpublic ViewResolver beanNameViewResolver() {\n\t\t\tBeanNameViewResolver viewResolver = new BeanNameViewResolver();\n\t\t\tviewResolver.setOrder(Integer.MIN_VALUE);\n\t\t\treturn viewResolver;\n\t\t}\n\n\t\t@Bean\n\t\t@ConditionalOnBean(SignInAdapter.class)\n\t\t@ConditionalOnMissingBean(ProviderSignInController.class)\n\t\tpublic ProviderSignInController signInController(\n\t\t\t\tConnectionFactoryLocator factoryLocator,\n\t\t\t\tUsersConnectionRepository usersRepository, SignInAdapter signInAdapter) {\n\t\t\tProviderSignInController controller = new ProviderSignInController(\n\t\t\t\t\tfactoryLocator, usersRepository, signInAdapter);\n\t\t\tif (!CollectionUtils.isEmpty(this.signInInterceptors)) {\n\t\t\t\tcontroller.setSignInInterceptors(this.signInInterceptors);\n\t\t\t}\n\t\t\treturn controller;\n\t\t}\n\n\t}\n\n\t@Configuration\n\t@EnableSocial\n\t@ConditionalOnWebApplication\n\t@ConditionalOnMissingClass(SecurityContextHolder.class)\n\tprotected static class AnonymousUserIdSourceConfig extends SocialConfigurerAdapter {\n\n\t\t@Override\n\t\tpublic UserIdSource getUserIdSource() {\n\t\t\treturn new UserIdSource() {\n\t\t\t\t@Override\n\t\t\t\tpublic String getUserId() {\n\t\t\t\t\treturn "anonymous";\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t}\n\n\t@Configuration\n\t@EnableSocial\n\t@ConditionalOnWebApplication\n\t@ConditionalOnClass(SecurityContextHolder.class)\n\tprotected static class AuthenticationUserIdSourceConfig extends\n\t\t\tSocialConfigurerAdapter {\n\n\t\t@Override\n\t\tpublic UserIdSource getUserIdSource() {\n\t\t\treturn new SecurityContextUserIdSource();\n\t\t}\n\n\t}\n\n\tprivate static class SecurityContextUserIdSource implements UserIdSource {\n\n\t\t@Override\n\t\tpublic String getUserId() {\n\t\t\tSecurityContext context = SecurityContextHolder.getContext();\n\t\t\tAuthentication authentication = context.getAuthentication();\n\t\t\tAssert.state(authentication != null, "Unable to get a "\n\t\t\t\t\t+ "ConnectionRepository: no user signed in");\n\t\t\treturn authentication.getName();\n\t\t}\n\n\t}\n}\n', '_nloc': None, '_complexity': None, '_token_count': None, '_function_list': []}
